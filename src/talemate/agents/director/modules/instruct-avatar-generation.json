{
  "title": "Instruct Avatar Generation",
  "id": "15f38845-423d-48ca-9f08-5121d6392c37",
  "properties": {},
  "x": 0,
  "y": 0,
  "width": 200,
  "height": 100,
  "collapsed": false,
  "inherited": false,
  "registry": "agents/director/instructAvatarGeneration",
  "nodes": {
    "36c14fc2-e6b7-494e-a44b-be2cd6196d8b": {
      "title": "true",
      "id": "36c14fc2-e6b7-494e-a44b-be2cd6196d8b",
      "properties": {
        "value": true
      },
      "x": -1308,
      "y": 411,
      "width": 210,
      "height": 58,
      "collapsed": true,
      "inherited": false,
      "registry": "core/MakeBool",
      "base_type": "core/Node"
    },
    "c095eb24-0f41-435a-a793-fea93431a338": {
      "title": "character_name",
      "id": "c095eb24-0f41-435a-a793-fea93431a338",
      "properties": {
        "name": "character_name",
        "typ": "str"
      },
      "x": -1868,
      "y": 71,
      "width": 210,
      "height": 82,
      "collapsed": false,
      "inherited": false,
      "registry": "core/functions/Argument",
      "base_type": "core/Node"
    },
    "e94ff6f8-43d4-4000-80a8-20afd89fd990": {
      "title": "Validate Character",
      "id": "e94ff6f8-43d4-4000-80a8-20afd89fd990",
      "properties": {
        "error_message": "",
        "character_status": "all",
        "create_placeholder": false
      },
      "x": -1588,
      "y": 81,
      "width": 210,
      "height": 126,
      "collapsed": false,
      "inherited": false,
      "registry": "validation/ValidateCharacter",
      "base_type": "core/Node"
    },
    "67ff7480-eb71-4a22-b383-da40e08d69f2": {
      "title": "DEF generate_avatar",
      "id": "67ff7480-eb71-4a22-b383-da40e08d69f2",
      "properties": {
        "name": "generate_avatar"
      },
      "x": -246,
      "y": 340,
      "width": 210,
      "height": 78,
      "collapsed": false,
      "inherited": false,
      "registry": "core/functions/DefineFunction",
      "base_type": "core/Node"
    },
    "a9281af3-141d-45f7-8611-d5e5725b040a": {
      "title": "IN state",
      "id": "a9281af3-141d-45f7-8611-d5e5725b040a",
      "properties": {
        "input_type": "any",
        "input_name": "state",
        "input_optional": false,
        "input_group": "",
        "num": 0
      },
      "x": 20,
      "y": -457,
      "width": 210,
      "height": 154,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Input",
      "base_type": "core/Node"
    },
    "545489e7-21c4-44d5-805d-98c42604e332": {
      "title": "OUT state",
      "id": "545489e7-21c4-44d5-805d-98c42604e332",
      "properties": {
        "output_type": "any",
        "output_name": "state",
        "num": 0
      },
      "x": 730,
      "y": -447,
      "width": 210,
      "height": 106,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Output",
      "base_type": "core/Node"
    },
    "ece9a82a-99db-44c5-9fe0-38653b8523a0": {
      "title": "SET local.character",
      "id": "ece9a82a-99db-44c5-9fe0-38653b8523a0",
      "properties": {
        "name": "character",
        "scope": "local"
      },
      "x": 380,
      "y": -187,
      "width": 210,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/SetState",
      "base_type": "core/Node"
    },
    "f243ad4d-7957-4993-bf88-f6d9f78c9211": {
      "title": "OUT character",
      "id": "f243ad4d-7957-4993-bf88-f6d9f78c9211",
      "properties": {
        "output_type": "character",
        "output_name": "character",
        "num": 1
      },
      "x": 1050,
      "y": -147,
      "width": 210,
      "height": 106,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Output",
      "base_type": "core/Node"
    },
    "799b30cd-cc89-4c6a-a64d-467cdac69135": {
      "title": "true",
      "id": "799b30cd-cc89-4c6a-a64d-467cdac69135",
      "properties": {
        "value": true
      },
      "x": 922,
      "y": 71,
      "width": 210,
      "height": 58,
      "collapsed": true,
      "inherited": false,
      "registry": "core/MakeBool",
      "base_type": "core/Node"
    },
    "72ced384-4c92-4aa4-bd33-bd6016883105": {
      "title": "director",
      "id": "72ced384-4c92-4aa4-bd33-bd6016883105",
      "properties": {
        "agent_name": "director"
      },
      "x": 1112,
      "y": 231,
      "width": 210,
      "height": 58,
      "collapsed": true,
      "inherited": false,
      "registry": "agents/GetAgent",
      "base_type": "core/Node"
    },
    "d7406d15-103c-4f96-aa43-476a85f4da3d": {
      "title": "Load Template",
      "id": "d7406d15-103c-4f96-aa43-476a85f4da3d",
      "properties": {
        "scope": "director",
        "name": "instruct-avatar-generation"
      },
      "x": 702,
      "y": 261,
      "width": 238,
      "height": 102,
      "collapsed": false,
      "inherited": false,
      "registry": "prompt/LoadTemplate",
      "base_type": "core/Node"
    },
    "564e7716-151c-4845-a722-ac6e3e3c6be5": {
      "title": "AI Function Callback",
      "id": "564e7716-151c-4845-a722-ac6e3e3c6be5",
      "properties": {
        "name": "my_function",
        "allow_multiple_calls": false
      },
      "x": 1252,
      "y": 1031,
      "width": 210,
      "height": 102,
      "collapsed": false,
      "inherited": false,
      "registry": "focal/Callback",
      "base_type": "core/Node"
    },
    "41359881-cda9-439e-8307-70cbf7c982ce": {
      "title": "List Collector",
      "id": "41359881-cda9-439e-8307-70cbf7c982ce",
      "properties": {},
      "x": 1532,
      "y": 1041,
      "width": 140,
      "height": 81,
      "collapsed": false,
      "inherited": false,
      "registry": "data/ListCollector",
      "dynamic_inputs": [
        {
          "name": "item0",
          "type": "*"
        }
      ],
      "base_type": "core/DynamicSocketNodeBase"
    },
    "12d035df-532c-4ce3-852e-317507821bc1": {
      "title": "FN generate_avatar",
      "id": "12d035df-532c-4ce3-852e-317507821bc1",
      "properties": {
        "name": "generate_avatar"
      },
      "x": 982,
      "y": 1031,
      "width": 210,
      "height": 78,
      "collapsed": false,
      "inherited": false,
      "registry": "core/functions/GetFunction",
      "base_type": "core/Node"
    },
    "0c7de362-cdb6-4142-8cd8-1d4bb61a550b": {
      "title": "instructions",
      "id": "0c7de362-cdb6-4142-8cd8-1d4bb61a550b",
      "properties": {
        "name": "instructions",
        "typ": "str"
      },
      "x": -1868,
      "y": 261,
      "width": 210,
      "height": 82,
      "collapsed": false,
      "inherited": false,
      "registry": "core/functions/Argument",
      "base_type": "core/Node"
    },
    "ec055bde-7088-4a06-a780-65bb5a428361": {
      "title": "asset_name",
      "id": "ec055bde-7088-4a06-a780-65bb5a428361",
      "properties": {
        "name": "asset_name",
        "typ": "str"
      },
      "x": -1857,
      "y": 710,
      "width": 210,
      "height": 82,
      "collapsed": false,
      "inherited": false,
      "registry": "core/functions/Argument",
      "base_type": "core/Node"
    },
    "f82858b1-8c72-47f9-b2c2-91554f94719e": {
      "title": "UUID",
      "id": "f82858b1-8c72-47f9-b2c2-91554f94719e",
      "properties": {
        "max_length": 4
      },
      "x": -1617,
      "y": 770,
      "width": 210,
      "height": 78,
      "collapsed": true,
      "inherited": false,
      "registry": "data/UUID",
      "base_type": "core/Node"
    },
    "cc0d9426-5049-4812-899c-0e7d8f2cceef": {
      "title": "Return",
      "id": "cc0d9426-5049-4812-899c-0e7d8f2cceef",
      "properties": {},
      "x": -727,
      "y": 340,
      "width": 140,
      "height": 26,
      "collapsed": false,
      "inherited": false,
      "registry": "core/functions/Return",
      "base_type": "core/Node"
    },
    "41f6f0f9-04db-4b3c-a2b2-c131e3db14e6": {
      "title": "AI Function Callback Metadata",
      "id": "41f6f0f9-04db-4b3c-a2b2-c131e3db14e6",
      "properties": {
        "instructions": "Write a brief instruction of the avatar to generate. Keep it concise and brief. Your main focus must be expression, followed by anything that is out of the ordinary. You do NOT need to provide the character's general details as that information is already provided elsewhere.",
        "examples": [
          {
            "character_name": "Sarah",
            "instructions": "Her expression should be joyful and her head should be slightly tilted to one side, providing a profile view of her face.",
            "asset_name": "sarah_avatar_joyful",
            "tags": [
              "sarah",
              "joy",
              "happy",
              "content",
              "profile view"
            ]
          },
          {
            "character_name": "Jason",
            "instructions": "His expression should be tired. A long bloody scratch is now marking his left cheek from where the creature scratches him. His head is tilted slightly downwards indicating his exhaustion",
            "asset_name": "jason_avatar_tired_wounded",
            "tags": [
              "jason",
              "tired",
              "exhausted",
              "scratch",
              "blood",
              "looking down"
            ]
          }
        ]
      },
      "x": -527,
      "y": 330,
      "width": 244,
      "height": 82,
      "collapsed": false,
      "inherited": false,
      "registry": "focal/Metadata",
      "base_type": "core/Node"
    },
    "f00eadab-691d-47cb-ba8f-9a0498df8c10": {
      "title": "Generate Avatar",
      "id": "f00eadab-691d-47cb-ba8f-9a0498df8c10",
      "properties": {},
      "x": -1077,
      "y": 330,
      "width": 312,
      "height": 166,
      "collapsed": false,
      "inherited": false,
      "registry": "agents/visual/generateAvatar",
      "base_type": "core/Graph"
    },
    "a2886e90-ca31-484e-926c-c0af8b11d653": {
      "title": "Jinja2 Format",
      "id": "a2886e90-ca31-484e-926c-c0af8b11d653",
      "properties": {
        "template": "{{ asset_name }}_{{ uuid }}"
      },
      "x": -1477,
      "y": 630,
      "width": 210,
      "height": 153,
      "collapsed": false,
      "inherited": false,
      "registry": "prompt/Jinja2Format",
      "dynamic_inputs": [
        {
          "name": "item0",
          "type": "*"
        },
        {
          "name": "item1",
          "type": "*"
        }
      ],
      "base_type": "core/DynamicSocketNodeBase"
    },
    "d27d4c50-7007-4902-b1c0-b000ea9ca857": {
      "title": "Build Prompt",
      "id": "d27d4c50-7007-4902-b1c0-b000ea9ca857",
      "properties": {
        "template_file": "base",
        "scope": "common",
        "instructions": "",
        "reserved_tokens": 312,
        "limit_max_tokens": 0,
        "include_scene_intent": true,
        "include_extra_context": false,
        "include_memory_context": false,
        "include_scene_context": true,
        "include_character_context": false,
        "include_gamestate_context": false,
        "memory_prompt": "",
        "prefill_prompt": "",
        "return_prefill_prompt": false,
        "dedupe_enabled": true,
        "response_length": 0,
        "technical": false
      },
      "x": 1479,
      "y": 203,
      "width": 304,
      "height": 542,
      "collapsed": false,
      "inherited": false,
      "registry": "prompt/BuildPrompt",
      "base_type": "core/Node"
    },
    "5b550988-91a5-412f-8651-a6570ec3dee6": {
      "title": "Search Assets",
      "id": "5b550988-91a5-412f-8651-a6570ec3dee6",
      "properties": {
        "vis_type": "CHARACTER_PORTRAIT",
        "character_name": "",
        "tags": [],
        "reference_vis_types": [],
        "tag_match_mode": "all"
      },
      "x": 562,
      "y": 441,
      "width": 329,
      "height": 274,
      "collapsed": false,
      "inherited": false,
      "registry": "assets/SearchAssets",
      "base_type": "core/Node"
    },
    "034f3a6b-eedd-4bb0-a516-1418db3f4af5": {
      "title": "Unpack Character",
      "id": "034f3a6b-eedd-4bb0-a516-1418db3f4af5",
      "properties": {},
      "x": 289,
      "y": 453,
      "width": 212,
      "height": 146,
      "collapsed": false,
      "inherited": false,
      "registry": "scene/UnpackCharacter",
      "base_type": "core/Node"
    },
    "e91b7211-ca83-4e97-be00-dd57a07eb809": {
      "title": "AI Function Calling",
      "id": "e91b7211-ca83-4e97-be00-dd57a07eb809",
      "properties": {
        "template": null,
        "max_calls": 1,
        "retries": 0,
        "response_length": 1024
      },
      "x": 1932,
      "y": 871,
      "width": 210,
      "height": 250,
      "collapsed": false,
      "inherited": false,
      "registry": "focal/Focal",
      "base_type": "core/Node"
    },
    "2677b032-b4e4-4108-8d4b-01eaf269d073": {
      "title": "Stage 1",
      "id": "2677b032-b4e4-4108-8d4b-01eaf269d073",
      "properties": {
        "stage": 1
      },
      "x": 2269,
      "y": 923,
      "width": 210,
      "height": 118,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Stage",
      "base_type": "core/Node"
    },
    "e35fbff6-b098-4452-a4f1-4044084e21e4": {
      "title": "Stage 0",
      "id": "e35fbff6-b098-4452-a4f1-4044084e21e4",
      "properties": {
        "stage": 0
      },
      "x": 761,
      "y": -170,
      "width": 210,
      "height": 118,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Stage",
      "base_type": "core/Node"
    },
    "2f10fe39-b580-4bc8-8f68-a73c263f45e4": {
      "title": "GET local.character",
      "id": "2f10fe39-b580-4bc8-8f68-a73c263f45e4",
      "properties": {
        "name": "character",
        "scope": "local"
      },
      "x": 50,
      "y": 350,
      "width": 210,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "62553126-28ab-4a0d-8475-f8aecaa7c224": {
      "title": "Get Assets",
      "id": "62553126-28ab-4a0d-8475-f8aecaa7c224",
      "properties": {
        "asset_ids": []
      },
      "x": 932,
      "y": 441,
      "width": 210,
      "height": 98,
      "collapsed": false,
      "inherited": false,
      "registry": "assets/GetAssets",
      "base_type": "core/Node"
    },
    "35561afd-fda0-479b-9249-01549f0b756b": {
      "title": "Jinja2 Format",
      "id": "35561afd-fda0-479b-9249-01549f0b756b",
      "properties": {
        "template": ""
      },
      "x": 1190,
      "y": 340,
      "width": 210,
      "height": 153,
      "collapsed": false,
      "inherited": false,
      "registry": "prompt/Jinja2Format",
      "dynamic_inputs": [
        {
          "name": "item0",
          "type": "*"
        },
        {
          "name": "item1",
          "type": "*"
        }
      ],
      "base_type": "core/DynamicSocketNodeBase"
    },
    "5f51105a-6e56-4ef4-bc70-bd968c68f0c8": {
      "title": "tags",
      "id": "5f51105a-6e56-4ef4-bc70-bd968c68f0c8",
      "properties": {
        "name": "tags",
        "typ": "list"
      },
      "x": -1867,
      "y": 525,
      "width": 210,
      "height": 82,
      "collapsed": false,
      "inherited": false,
      "registry": "core/functions/Argument",
      "base_type": "core/Node"
    },
    "5b45cd47-9fd2-4b36-a1f8-b8bbe9339e49": {
      "title": "IN character",
      "id": "5b45cd47-9fd2-4b36-a1f8-b8bbe9339e49",
      "properties": {
        "input_type": "character",
        "input_name": "character",
        "input_optional": false,
        "input_group": "",
        "num": 1
      },
      "x": 30,
      "y": -187,
      "width": 210,
      "height": 154,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Input",
      "base_type": "core/Node"
    },
    "115b6788-d643-4624-b865-e51b37636840": {
      "title": "Module Style",
      "id": "115b6788-d643-4624-b865-e51b37636840",
      "properties": {
        "node_color": "#1e3a38",
        "title_color": "#2d5a55",
        "auto_title": null,
        "icon": "F16A3"
      },
      "x": 1050,
      "y": -450,
      "width": 210,
      "height": 110,
      "collapsed": false,
      "inherited": false,
      "registry": "util/ModuleStyle",
      "base_type": "core/Node"
    }
  },
  "edges": {
    "36c14fc2-e6b7-494e-a44b-be2cd6196d8b.value": [
      "f00eadab-691d-47cb-ba8f-9a0498df8c10.set_current_avatar",
      "f00eadab-691d-47cb-ba8f-9a0498df8c10.set_default_avatar"
    ],
    "c095eb24-0f41-435a-a793-fea93431a338.value": [
      "e94ff6f8-43d4-4000-80a8-20afd89fd990.value"
    ],
    "e94ff6f8-43d4-4000-80a8-20afd89fd990.character": [
      "f00eadab-691d-47cb-ba8f-9a0498df8c10.state",
      "f00eadab-691d-47cb-ba8f-9a0498df8c10.character"
    ],
    "a9281af3-141d-45f7-8611-d5e5725b040a.value": [
      "545489e7-21c4-44d5-805d-98c42604e332.value"
    ],
    "ece9a82a-99db-44c5-9fe0-38653b8523a0.value": [
      "e35fbff6-b098-4452-a4f1-4044084e21e4.state"
    ],
    "799b30cd-cc89-4c6a-a64d-467cdac69135.value": [
      "d27d4c50-7007-4902-b1c0-b000ea9ca857.state"
    ],
    "72ced384-4c92-4aa4-bd33-bd6016883105.agent": [
      "d27d4c50-7007-4902-b1c0-b000ea9ca857.agent"
    ],
    "d7406d15-103c-4f96-aa43-476a85f4da3d.template_content": [
      "35561afd-fda0-479b-9249-01549f0b756b.template"
    ],
    "564e7716-151c-4845-a722-ac6e3e3c6be5.callback": [
      "41359881-cda9-439e-8307-70cbf7c982ce.item0"
    ],
    "41359881-cda9-439e-8307-70cbf7c982ce.list": [
      "e91b7211-ca83-4e97-be00-dd57a07eb809.callbacks"
    ],
    "12d035df-532c-4ce3-852e-317507821bc1.fn": [
      "564e7716-151c-4845-a722-ac6e3e3c6be5.fn"
    ],
    "12d035df-532c-4ce3-852e-317507821bc1.name": [
      "564e7716-151c-4845-a722-ac6e3e3c6be5.name"
    ],
    "0c7de362-cdb6-4142-8cd8-1d4bb61a550b.value": [
      "f00eadab-691d-47cb-ba8f-9a0498df8c10.instructions"
    ],
    "ec055bde-7088-4a06-a780-65bb5a428361.value": [
      "a2886e90-ca31-484e-926c-c0af8b11d653.item0"
    ],
    "f82858b1-8c72-47f9-b2c2-91554f94719e.uuid": [
      "a2886e90-ca31-484e-926c-c0af8b11d653.item1"
    ],
    "cc0d9426-5049-4812-899c-0e7d8f2cceef.value": [
      "41f6f0f9-04db-4b3c-a2b2-c131e3db14e6.state"
    ],
    "41f6f0f9-04db-4b3c-a2b2-c131e3db14e6.state": [
      "67ff7480-eb71-4a22-b383-da40e08d69f2.nodes"
    ],
    "f00eadab-691d-47cb-ba8f-9a0498df8c10.state": [
      "cc0d9426-5049-4812-899c-0e7d8f2cceef.value"
    ],
    "a2886e90-ca31-484e-926c-c0af8b11d653.result": [
      "f00eadab-691d-47cb-ba8f-9a0498df8c10.asset_name"
    ],
    "d27d4c50-7007-4902-b1c0-b000ea9ca857.state": [
      "e91b7211-ca83-4e97-be00-dd57a07eb809.state"
    ],
    "d27d4c50-7007-4902-b1c0-b000ea9ca857.agent": [
      "e91b7211-ca83-4e97-be00-dd57a07eb809.agent"
    ],
    "d27d4c50-7007-4902-b1c0-b000ea9ca857.prompt": [
      "e91b7211-ca83-4e97-be00-dd57a07eb809.prompt"
    ],
    "5b550988-91a5-412f-8651-a6570ec3dee6.asset_ids": [
      "62553126-28ab-4a0d-8475-f8aecaa7c224.asset_ids"
    ],
    "034f3a6b-eedd-4bb0-a516-1418db3f4af5.name": [
      "5b550988-91a5-412f-8651-a6570ec3dee6.character_name"
    ],
    "e91b7211-ca83-4e97-be00-dd57a07eb809.state": [
      "2677b032-b4e4-4108-8d4b-01eaf269d073.state"
    ],
    "e35fbff6-b098-4452-a4f1-4044084e21e4.state": [
      "f243ad4d-7957-4993-bf88-f6d9f78c9211.value"
    ],
    "2f10fe39-b580-4bc8-8f68-a73c263f45e4.value": [
      "034f3a6b-eedd-4bb0-a516-1418db3f4af5.character",
      "35561afd-fda0-479b-9249-01549f0b756b.item0"
    ],
    "62553126-28ab-4a0d-8475-f8aecaa7c224.assets": [
      "35561afd-fda0-479b-9249-01549f0b756b.item1"
    ],
    "35561afd-fda0-479b-9249-01549f0b756b.result": [
      "d27d4c50-7007-4902-b1c0-b000ea9ca857.instructions"
    ],
    "5f51105a-6e56-4ef4-bc70-bd968c68f0c8.value": [
      "f00eadab-691d-47cb-ba8f-9a0498df8c10.tags"
    ],
    "5b45cd47-9fd2-4b36-a1f8-b8bbe9339e49.value": [
      "ece9a82a-99db-44c5-9fe0-38653b8523a0.value"
    ]
  },
  "groups": [
    {
      "title": "Function",
      "x": -1893,
      "y": -4,
      "width": 1881,
      "height": 833,
      "color": "#b06634",
      "font_size": 24,
      "inherited": false
    },
    {
      "title": "Input",
      "x": -5,
      "y": -532,
      "width": 1290,
      "height": 524,
      "color": "#88A",
      "font_size": 24,
      "inherited": false
    },
    {
      "title": "Process",
      "x": -6,
      "y": -3,
      "width": 2510,
      "height": 1162,
      "color": "#3f789e",
      "font_size": 24,
      "inherited": false
    }
  ],
  "comments": [],
  "extends": null,
  "base_type": "core/Graph",
  "inputs": [],
  "outputs": [],
  "module_properties": {},
  "style": {
    "title_color": "#2d5a55",
    "node_color": "#1e3a38",
    "icon": "F16A3",
    "auto_title": null,
    "counterpart": null
  }
}