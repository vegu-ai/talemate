{
  "title": "Generate Avatar",
  "id": "64a90128-1b00-4ec8-bb2f-8f3b6df753b1",
  "properties": {},
  "x": 0,
  "y": 0,
  "width": 200,
  "height": 100,
  "collapsed": false,
  "inherited": false,
  "registry": "agents/visual/generateAvatar",
  "nodes": {
    "70eee13c-fd74-48ad-b271-ed52d1ee3d08": {
      "title": "OUT state",
      "id": "70eee13c-fd74-48ad-b271-ed52d1ee3d08",
      "properties": {
        "output_type": "any",
        "output_name": "state",
        "num": 0
      },
      "x": 297,
      "y": 77,
      "width": 210,
      "height": 106,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Output",
      "base_type": "core/Node"
    },
    "bec1942f-73ed-4e79-b81d-a642acd5ef3d": {
      "title": "IN state",
      "id": "bec1942f-73ed-4e79-b81d-a642acd5ef3d",
      "properties": {
        "input_type": "any",
        "input_name": "state",
        "input_optional": false,
        "input_group": "",
        "num": 0
      },
      "x": 27,
      "y": 67,
      "width": 210,
      "height": 154,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Input",
      "base_type": "core/Node"
    },
    "6180b4f6-b427-46c5-aff0-b3c9bc9456cd": {
      "title": "SET local.character",
      "id": "6180b4f6-b427-46c5-aff0-b3c9bc9456cd",
      "properties": {
        "name": "character",
        "scope": "local"
      },
      "x": 307,
      "y": 339,
      "width": 210,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/SetState",
      "base_type": "core/Node"
    },
    "919f53fb-15df-4d24-9448-a35d7e97d95e": {
      "title": "Make String",
      "id": "919f53fb-15df-4d24-9448-a35d7e97d95e",
      "properties": {
        "value": "CHARACTER_PORTRAIT"
      },
      "x": 316,
      "y": 4152,
      "width": 241,
      "height": 58,
      "collapsed": false,
      "inherited": false,
      "registry": "data/string/Make",
      "base_type": "core/Node"
    },
    "532da8c8-c513-4fe7-b409-db11dac3e14c": {
      "title": "GET local.reference_asset",
      "id": "532da8c8-c513-4fe7-b409-db11dac3e14c",
      "properties": {
        "name": "reference_asset",
        "scope": "local"
      },
      "x": 26,
      "y": 3752,
      "width": 210,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "582f31dd-5e5e-4e0a-8e13-c69bd53bf1c5": {
      "title": "Switch",
      "id": "582f31dd-5e5e-4e0a-8e13-c69bd53bf1c5",
      "properties": {
        "pass_through": false
      },
      "x": 316,
      "y": 3782,
      "width": 210,
      "height": 78,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Switch",
      "base_type": "core/Node"
    },
    "e1050ab0-0e71-437e-a9ff-5e363dc93134": {
      "title": "GET local.character",
      "id": "e1050ab0-0e71-437e-a9ff-5e363dc93134",
      "properties": {
        "name": "character",
        "scope": "local"
      },
      "x": 316,
      "y": 3942,
      "width": 210,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "77b5b1ec-092c-47c8-afe0-495e9be9c306": {
      "title": "SET local.instructions",
      "id": "77b5b1ec-092c-47c8-afe0-495e9be9c306",
      "properties": {
        "name": "instructions",
        "scope": "local"
      },
      "x": 307,
      "y": 601,
      "width": 210,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/SetState",
      "base_type": "core/Node"
    },
    "9e71248d-dae3-40f7-9877-051247b38438": {
      "title": "GET local.instructions",
      "id": "9e71248d-dae3-40f7-9877-051247b38438",
      "properties": {
        "name": "instructions",
        "scope": "local"
      },
      "x": 316,
      "y": 4312,
      "width": 210,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "50a3576d-17da-4898-b80d-322b89fa4b99": {
      "title": "GET local.instructions",
      "id": "50a3576d-17da-4898-b80d-322b89fa4b99",
      "properties": {
        "name": "instructions",
        "scope": "local"
      },
      "x": 25,
      "y": 4969,
      "width": 210,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "2e18f4ff-589d-4acd-b2d9-319e7aa6f787": {
      "title": "As Bool",
      "id": "2e18f4ff-589d-4acd-b2d9-319e7aa6f787",
      "properties": {
        "default": false
      },
      "x": 307,
      "y": 836,
      "width": 210,
      "height": 58,
      "collapsed": false,
      "inherited": false,
      "registry": "core/AsBool",
      "base_type": "core/Node"
    },
    "9f3e368c-51fc-43ca-8232-3d19f192cb4b": {
      "title": "SET local.set_current_avatar",
      "id": "9f3e368c-51fc-43ca-8232-3d19f192cb4b",
      "properties": {
        "name": "set_current_avatar",
        "scope": "local"
      },
      "x": 547,
      "y": 826,
      "width": 235,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/SetState",
      "base_type": "core/Node"
    },
    "69fee541-2657-4d83-9e76-797414ea9216": {
      "title": "As Bool",
      "id": "69fee541-2657-4d83-9e76-797414ea9216",
      "properties": {
        "default": false
      },
      "x": 307,
      "y": 1082,
      "width": 210,
      "height": 58,
      "collapsed": false,
      "inherited": false,
      "registry": "core/AsBool",
      "base_type": "core/Node"
    },
    "d74a28ad-9466-4308-bf5d-db140ec603be": {
      "title": "SET local.set_default_avatar",
      "id": "d74a28ad-9466-4308-bf5d-db140ec603be",
      "properties": {
        "name": "set_default_avatar",
        "scope": "local"
      },
      "x": 547,
      "y": 1069,
      "width": 235,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/SetState",
      "base_type": "core/Node"
    },
    "520016cb-68f3-48fc-9140-fab4f543dc3e": {
      "title": "OUT instructions",
      "id": "520016cb-68f3-48fc-9140-fab4f543dc3e",
      "properties": {
        "output_type": "str",
        "output_name": "instructions",
        "num": 2
      },
      "x": 1328,
      "y": 646,
      "width": 210,
      "height": 106,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Output",
      "base_type": "core/Node"
    },
    "5704877a-1515-4278-afc6-63407582bb2a": {
      "title": "OUT set_current_avatar",
      "id": "5704877a-1515-4278-afc6-63407582bb2a",
      "properties": {
        "output_type": "bool",
        "output_name": "set_current_avatar",
        "num": 3
      },
      "x": 1328,
      "y": 866,
      "width": 210,
      "height": 106,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Output",
      "base_type": "core/Node"
    },
    "b3dfe45d-e034-4c0c-acb3-5fd1ab9f1ab5": {
      "title": "OUT set_default_avatar",
      "id": "b3dfe45d-e034-4c0c-acb3-5fd1ab9f1ab5",
      "properties": {
        "output_type": "bool",
        "output_name": "set_default_avatar",
        "num": 5
      },
      "x": 1328,
      "y": 1116,
      "width": 210,
      "height": 106,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Output",
      "base_type": "core/Node"
    },
    "364b7d86-9c20-4be2-b13c-98241d1d56ae": {
      "title": "Stage 0",
      "id": "364b7d86-9c20-4be2-b13c-98241d1d56ae",
      "properties": {
        "stage": 0
      },
      "x": 918,
      "y": 680,
      "width": 210,
      "height": 118,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Stage",
      "base_type": "core/Node"
    },
    "25f779e2-a2de-4679-ad02-68bc0abfc97f": {
      "title": "Generate Visual Asset",
      "id": "25f779e2-a2de-4679-ad02-68bc0abfc97f",
      "properties": {},
      "x": 816,
      "y": 4122,
      "width": 262,
      "height": 226,
      "collapsed": false,
      "inherited": false,
      "registry": "agents/visual/generateVisualAsset",
      "base_type": "core/Graph"
    },
    "b7b66f17-9e3a-4130-a820-4694bb7954a8": {
      "title": "Set",
      "id": "b7b66f17-9e3a-4130-a820-4694bb7954a8",
      "properties": {
        "attribute": "character_name"
      },
      "x": 1052,
      "y": 5112,
      "width": 210,
      "height": 98,
      "collapsed": false,
      "inherited": false,
      "registry": "data/Set",
      "base_type": "core/Node"
    },
    "6f376e1c-4f0a-49e3-ba5b-6bfbc5d4c379": {
      "title": "SET local.asset_name",
      "id": "6f376e1c-4f0a-49e3-ba5b-6bfbc5d4c379",
      "properties": {
        "name": "asset_name",
        "scope": "local"
      },
      "x": 547,
      "y": 1764,
      "width": 210,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/SetState",
      "base_type": "core/Node"
    },
    "fada2d18-c2ea-4445-834f-ffe2a0cc5c45": {
      "title": "IN asset_name",
      "id": "fada2d18-c2ea-4445-834f-ffe2a0cc5c45",
      "properties": {
        "input_type": "str",
        "input_name": "asset_name",
        "input_optional": true,
        "input_group": "",
        "num": 7
      },
      "x": 27,
      "y": 1781,
      "width": 210,
      "height": 154,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Input",
      "base_type": "core/Node"
    },
    "f689149e-3f57-496a-97c9-bbfda3c0b52a": {
      "title": "IN tags",
      "id": "f689149e-3f57-496a-97c9-bbfda3c0b52a",
      "properties": {
        "input_type": "list",
        "input_name": "tags",
        "input_optional": true,
        "input_group": "",
        "num": 6
      },
      "x": 27,
      "y": 1444,
      "width": 210,
      "height": 154,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Input",
      "base_type": "core/Node"
    },
    "8a20cc8d-965d-4cb8-93bf-0c0dc3fd0868": {
      "title": "IN set_default_avatar",
      "id": "8a20cc8d-965d-4cb8-93bf-0c0dc3fd0868",
      "properties": {
        "input_type": "bool",
        "input_name": "set_default_avatar",
        "input_optional": false,
        "input_group": "",
        "num": 5
      },
      "x": 27,
      "y": 1059,
      "width": 210,
      "height": 154,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Input",
      "base_type": "core/Node"
    },
    "e061f98e-5fab-40a6-92c5-ed1ef73e70f8": {
      "title": "IN set_current_avatar",
      "id": "e061f98e-5fab-40a6-92c5-ed1ef73e70f8",
      "properties": {
        "input_type": "bool",
        "input_name": "set_current_avatar",
        "input_optional": false,
        "input_group": "",
        "num": 3
      },
      "x": 27,
      "y": 816,
      "width": 210,
      "height": 154,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Input",
      "base_type": "core/Node"
    },
    "2da731c0-aed3-4dbc-a523-a43c1e19b473": {
      "title": "IN instructions",
      "id": "2da731c0-aed3-4dbc-a523-a43c1e19b473",
      "properties": {
        "input_type": "str",
        "input_name": "instructions",
        "input_optional": false,
        "input_group": "",
        "num": 2
      },
      "x": 27,
      "y": 551,
      "width": 210,
      "height": 154,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Input",
      "base_type": "core/Node"
    },
    "4bf4cc2c-fda6-4f3f-9e1e-5f1e3b3471d7": {
      "title": "IN character",
      "id": "4bf4cc2c-fda6-4f3f-9e1e-5f1e3b3471d7",
      "properties": {
        "input_type": "character",
        "input_name": "character",
        "input_optional": false,
        "input_group": "",
        "num": 1
      },
      "x": 27,
      "y": 308,
      "width": 210,
      "height": 154,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Input",
      "base_type": "core/Node"
    },
    "5e189b32-7b1b-4347-8d57-22bd14da327e": {
      "title": "Unpack Visual Generation Request",
      "id": "5e189b32-7b1b-4347-8d57-22bd14da327e",
      "properties": {},
      "x": 1350,
      "y": 5116,
      "width": 363,
      "height": 186,
      "collapsed": false,
      "inherited": false,
      "registry": "agents/visual/UnpackGenerationRequest",
      "base_type": "core/Node"
    },
    "9c0013ee-1340-4fd5-8e1c-dbbb2aadb16f": {
      "title": "GET local.generation_request",
      "id": "9c0013ee-1340-4fd5-8e1c-dbbb2aadb16f",
      "properties": {
        "name": "generation_request",
        "scope": "local"
      },
      "x": 1607,
      "y": 60,
      "width": 235,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "a71727c9-a167-40b9-a345-7f9c32f0211a": {
      "title": "OUT state",
      "id": "a71727c9-a167-40b9-a345-7f9c32f0211a",
      "properties": {
        "output_type": "visual/generation_request",
        "output_name": "generation_request",
        "num": 99
      },
      "x": 1937,
      "y": 80,
      "width": 309,
      "height": 106,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Output",
      "base_type": "core/Node"
    },
    "3cd66f03-788f-4f72-a576-90a6e5d29163": {
      "title": "OUT asset_name",
      "id": "3cd66f03-788f-4f72-a576-90a6e5d29163",
      "properties": {
        "output_type": "str",
        "output_name": "asset_name",
        "num": 7
      },
      "x": 1328,
      "y": 1757,
      "width": 210,
      "height": 106,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Output",
      "base_type": "core/Node"
    },
    "624767be-6e9d-4bbf-8def-1336b192b351": {
      "title": "OUT tags",
      "id": "624767be-6e9d-4bbf-8def-1336b192b351",
      "properties": {
        "output_type": "list",
        "output_name": "tags",
        "num": 6
      },
      "x": 1328,
      "y": 1457,
      "width": 210,
      "height": 106,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Output",
      "base_type": "core/Node"
    },
    "9a364ad1-0277-41d4-ad3e-32fe25e2c8a3": {
      "title": "OUT character",
      "id": "9a364ad1-0277-41d4-ad3e-32fe25e2c8a3",
      "properties": {
        "output_type": "character",
        "output_name": "character",
        "num": 1
      },
      "x": 1330,
      "y": 400,
      "width": 210,
      "height": 106,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Output",
      "base_type": "core/Node"
    },
    "3961d14c-1ac0-4e94-b6cf-b0df70d847da": {
      "title": "Module Style",
      "id": "3961d14c-1ac0-4e94-b6cf-b0df70d847da",
      "properties": {
        "title_color": "#2d5a55",
        "node_color": "#1e3a38",
        "auto_title": null,
        "icon": "F16A3"
      },
      "x": 1330,
      "y": 70,
      "width": 210,
      "height": 110,
      "collapsed": false,
      "inherited": false,
      "registry": "util/ModuleStyle",
      "base_type": "core/Node"
    },
    "6981bc93-69f6-4ecd-917b-16c3dc529a3e": {
      "title": "SET local.tags",
      "id": "6981bc93-69f6-4ecd-917b-16c3dc529a3e",
      "properties": {
        "name": "tags",
        "scope": "local"
      },
      "x": 547,
      "y": 1434,
      "width": 210,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/SetState",
      "base_type": "core/Node"
    },
    "98a6bb29-821e-4ac2-8794-929d9a7e5e15": {
      "title": "Unpack Visual Generation Request",
      "id": "98a6bb29-821e-4ac2-8794-929d9a7e5e15",
      "properties": {},
      "x": 1126,
      "y": 4354,
      "width": 363,
      "height": 186,
      "collapsed": false,
      "inherited": false,
      "registry": "agents/visual/UnpackGenerationRequest",
      "base_type": "core/Node"
    },
    "9916a889-2d11-424d-adea-519bfaca64c4": {
      "title": "IN asset_ctx",
      "id": "9916a889-2d11-424d-adea-519bfaca64c4",
      "properties": {
        "input_type": "asset_attachment_context",
        "input_name": "asset_ctx",
        "input_optional": true,
        "input_group": "",
        "num": 8
      },
      "x": 30,
      "y": 2030,
      "width": 210,
      "height": 154,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Input",
      "base_type": "core/Node"
    },
    "b362f642-5eb1-4d7f-abd4-1fddd5b9934d": {
      "title": "SET local.asset_ctx",
      "id": "b362f642-5eb1-4d7f-abd4-1fddd5b9934d",
      "properties": {
        "name": "asset_ctx",
        "scope": "local"
      },
      "x": 550,
      "y": 2030,
      "width": 218,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/SetState",
      "base_type": "core/Node"
    },
    "23fce388-6b3f-4bed-85d2-306fc0506c57": {
      "title": "OUT asset_ctx",
      "id": "23fce388-6b3f-4bed-85d2-306fc0506c57",
      "properties": {
        "output_type": "asset_attachment_context",
        "output_name": "asset_ctx",
        "num": 8
      },
      "x": 1320,
      "y": 2060,
      "width": 210,
      "height": 106,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Output",
      "base_type": "core/Node"
    },
    "34e22444-be73-401f-9a1c-99355d92f0aa": {
      "title": "Stage 0",
      "id": "34e22444-be73-401f-9a1c-99355d92f0aa",
      "properties": {
        "stage": 0
      },
      "x": 918,
      "y": 1634,
      "width": 210,
      "height": 118,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Stage",
      "base_type": "core/Node"
    },
    "7b07b286-d514-416b-b7dd-94a5c5754327": {
      "title": "GET local.asset_ctx",
      "id": "7b07b286-d514-416b-b7dd-94a5c5754327",
      "properties": {
        "name": "asset_ctx",
        "scope": "local"
      },
      "x": 25,
      "y": 5162,
      "width": 218,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "587a9224-a392-4f10-be85-d03bff530d4f": {
      "title": "GET local.character",
      "id": "587a9224-a392-4f10-be85-d03bff530d4f",
      "properties": {
        "name": "character",
        "scope": "local"
      },
      "x": 35,
      "y": 5356,
      "width": 210,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "9c215402-bbdb-4a65-a678-d4915ba815ca": {
      "title": "GET local.set_current_avatar",
      "id": "9c215402-bbdb-4a65-a678-d4915ba815ca",
      "properties": {
        "name": "set_current_avatar",
        "scope": "local"
      },
      "x": 26,
      "y": 3244,
      "width": 235,
      "height": 122,
      "collapsed": true,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "fd1e9c38-9178-46b5-840f-cefec6063d46": {
      "title": "GET local.set_default_avatar",
      "id": "fd1e9c38-9178-46b5-840f-cefec6063d46",
      "properties": {
        "name": "set_default_avatar",
        "scope": "local"
      },
      "x": 26,
      "y": 3204,
      "width": 235,
      "height": 122,
      "collapsed": true,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "1905ae2d-a859-47ac-94d8-71b31161534f": {
      "title": "GET local.asset_name",
      "id": "1905ae2d-a859-47ac-94d8-71b31161534f",
      "properties": {
        "name": "asset_name",
        "scope": "local"
      },
      "x": 26,
      "y": 3004,
      "width": 210,
      "height": 122,
      "collapsed": true,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "3d604b3c-5d13-4fa3-beac-3c0ba5d23771": {
      "title": "GET local.tags",
      "id": "3d604b3c-5d13-4fa3-beac-3c0ba5d23771",
      "properties": {
        "name": "tags",
        "scope": "local"
      },
      "x": 26,
      "y": 3044,
      "width": 210,
      "height": 122,
      "collapsed": true,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "442960c8-35c9-4097-9c93-5091d6cb9e28": {
      "title": "Make Asset Attachment Context",
      "id": "442960c8-35c9-4097-9c93-5091d6cb9e28",
      "properties": {
        "asset_name": "",
        "tags": [],
        "allow_auto_attach": false,
        "allow_override": false,
        "delete_old": false,
        "message_ids": [],
        "scene_cover": false,
        "character_cover": false,
        "override_scene_cover": false,
        "override_character_cover": false,
        "default_avatar": false,
        "current_avatar": false,
        "override_default_avatar": true,
        "override_current_avatar": true
      },
      "x": 436,
      "y": 2994,
      "width": 413,
      "height": 650,
      "collapsed": false,
      "inherited": false,
      "registry": "assets/MakeAssetAttachmentContext",
      "base_type": "core/Node"
    },
    "dcda417b-ae12-4e10-a5fe-9e0d83c393bd": {
      "title": "GET local.asset_ctx",
      "id": "dcda417b-ae12-4e10-a5fe-9e0d83c393bd",
      "properties": {
        "name": "asset_ctx",
        "scope": "local"
      },
      "x": 896,
      "y": 2804,
      "width": 218,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "240602dd-6a58-4a0d-a203-a17fdf01af84": {
      "title": "Stage 3",
      "id": "240602dd-6a58-4a0d-a203-a17fdf01af84",
      "properties": {
        "stage": 3
      },
      "x": 1562,
      "y": 3025,
      "width": 210,
      "height": 118,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Stage",
      "base_type": "core/Node"
    },
    "301cb0ff-7473-4550-bd96-81352c88e24d": {
      "title": "SET local.generation_request",
      "id": "301cb0ff-7473-4550-bd96-81352c88e24d",
      "properties": {
        "name": "generation_request",
        "scope": "local"
      },
      "x": 1532,
      "y": 4395,
      "width": 235,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/SetState",
      "base_type": "core/Node"
    },
    "8867ae83-17ea-4b7c-a126-30ca3d2c3aeb": {
      "title": "Stage 4",
      "id": "8867ae83-17ea-4b7c-a126-30ca3d2c3aeb",
      "properties": {
        "stage": 4
      },
      "x": 1962,
      "y": 4405,
      "width": 210,
      "height": 118,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Stage",
      "base_type": "core/Node"
    },
    "92826cbe-afca-4cf3-b6ae-0fbf4bee833f": {
      "title": "SET local.generation_request",
      "id": "92826cbe-afca-4cf3-b6ae-0fbf4bee833f",
      "properties": {
        "name": "generation_request",
        "scope": "local"
      },
      "x": 1847,
      "y": 5116,
      "width": 235,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/SetState",
      "base_type": "core/Node"
    },
    "65907aba-8fd7-4823-983c-21ba30f71609": {
      "title": "Stage 5",
      "id": "65907aba-8fd7-4823-983c-21ba30f71609",
      "properties": {
        "stage": 5
      },
      "x": 2257,
      "y": 5116,
      "width": 210,
      "height": 118,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Stage",
      "base_type": "core/Node"
    },
    "63b3fdcc-f74e-4e87-9528-48bb5afada96": {
      "title": "Update Object",
      "id": "63b3fdcc-f74e-4e87-9528-48bb5afada96",
      "properties": {},
      "x": 1266,
      "y": 3014,
      "width": 140,
      "height": 201,
      "collapsed": false,
      "inherited": false,
      "registry": "data/UpdateObject",
      "dynamic_inputs": [
        {
          "name": "item0",
          "type": "*"
        },
        {
          "name": "item1",
          "type": "*"
        },
        {
          "name": "item2",
          "type": "*"
        },
        {
          "name": "item3",
          "type": "*"
        },
        {
          "name": "item4",
          "type": "*"
        },
        {
          "name": "item5",
          "type": "*"
        }
      ],
      "base_type": "core/DynamicSocketNodeBase"
    },
    "3ea7321d-3057-4c23-847b-64cb1d55e557": {
      "title": "GET local.character",
      "id": "3ea7321d-3057-4c23-847b-64cb1d55e557",
      "properties": {
        "name": "character",
        "scope": "local"
      },
      "x": 65,
      "y": 2493,
      "width": 210,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "42e81dce-0ae6-46c2-a7dd-cbc2cedbf6d4": {
      "title": "vis_types",
      "id": "42e81dce-0ae6-46c2-a7dd-cbc2cedbf6d4",
      "properties": {
        "item_type": "any",
        "items": [
          "CHARACTER_PORTRAIT",
          "CHARACTER_CARD"
        ]
      },
      "x": 296,
      "y": 2329,
      "width": 210,
      "height": 102,
      "collapsed": false,
      "inherited": false,
      "registry": "data/MakeList",
      "base_type": "core/Node"
    },
    "faf12e0a-6173-4532-b75e-9a203aa12728": {
      "title": "Unpack Character",
      "id": "faf12e0a-6173-4532-b75e-9a203aa12728",
      "properties": {},
      "x": 295,
      "y": 2483,
      "width": 212,
      "height": 146,
      "collapsed": false,
      "inherited": false,
      "registry": "scene/UnpackCharacter",
      "base_type": "core/Node"
    },
    "77953c4e-d035-4989-a97e-3e14a0704a85": {
      "title": "Search Assets - Any Portrait",
      "id": "77953c4e-d035-4989-a97e-3e14a0704a85",
      "properties": {
        "vis_type": "CHARACTER_PORTRAIT",
        "character_name": "",
        "tags": [],
        "reference_vis_types": [],
        "tag_match_mode": "all"
      },
      "x": 572,
      "y": 2357,
      "width": 329,
      "height": 274,
      "collapsed": false,
      "inherited": false,
      "registry": "assets/SearchAssets",
      "base_type": "core/Node"
    },
    "99848a70-96a0-4a21-8386-ee6d8835e416": {
      "title": "Select Assets - Reference Portrait",
      "id": "99848a70-96a0-4a21-8386-ee6d8835e416",
      "properties": {
        "mode": "prioritize",
        "vis_types": [
          "CHARACTER_PORTRAIT"
        ],
        "reference_vis_types": [
          "CHARACTER_PORTRAIT"
        ]
      },
      "x": 974,
      "y": 2357,
      "width": 312,
      "height": 166,
      "collapsed": false,
      "inherited": false,
      "registry": "assets/SelectAssets",
      "base_type": "core/Node"
    },
    "42a99e33-536d-4c48-8474-e043a6f1c0b3": {
      "title": "Unpack Asset Selection Context",
      "id": "42a99e33-536d-4c48-8474-e043a6f1c0b3",
      "properties": {},
      "x": 2048,
      "y": 2352,
      "width": 304,
      "height": 186,
      "collapsed": false,
      "inherited": false,
      "registry": "assets/UnpackAssetSelectionContext",
      "base_type": "core/Node"
    },
    "981fd216-08d1-49f0-91e8-2f66c735d1e7": {
      "title": "SET local.reference_asset",
      "id": "981fd216-08d1-49f0-91e8-2f66c735d1e7",
      "properties": {
        "name": "reference_asset",
        "scope": "local"
      },
      "x": 2412,
      "y": 2352,
      "width": 244,
      "height": 127,
      "collapsed": false,
      "inherited": false,
      "registry": "state/SetState",
      "base_type": "core/Node"
    },
    "28ac3de8-6536-40d7-97ca-4a6d6f9cf16b": {
      "title": "GET local.asset_ctx",
      "id": "28ac3de8-6536-40d7-97ca-4a6d6f9cf16b",
      "properties": {
        "name": "asset_ctx",
        "scope": "local"
      },
      "x": 320,
      "y": 4520,
      "width": 218,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "52fff89e-722a-49f7-89b0-ef3b4ec81e19": {
      "title": "Unpack Character",
      "id": "52fff89e-722a-49f7-89b0-ef3b4ec81e19",
      "properties": {},
      "x": 349,
      "y": 5370,
      "width": 212,
      "height": 146,
      "collapsed": false,
      "inherited": false,
      "registry": "scene/UnpackCharacter",
      "base_type": "core/Node"
    },
    "02f5acc9-accd-42b6-981d-1eefe720ec1d": {
      "title": "GET local.reference_asset",
      "id": "02f5acc9-accd-42b6-981d-1eefe720ec1d",
      "properties": {
        "name": "reference_asset",
        "scope": "local"
      },
      "x": 29,
      "y": 4790,
      "width": 210,
      "height": 122,
      "collapsed": false,
      "inherited": false,
      "registry": "state/GetState",
      "base_type": "core/Node"
    },
    "c3bea3c5-7f66-4209-8b15-2747db733324": {
      "title": "Switch",
      "id": "c3bea3c5-7f66-4209-8b15-2747db733324",
      "properties": {
        "pass_through": true
      },
      "x": 306,
      "y": 4820,
      "width": 210,
      "height": 78,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Switch",
      "base_type": "core/Node"
    },
    "c32025d8-50c4-4095-adbf-b4e29f322d96": {
      "title": "Generate Image Edit",
      "id": "c32025d8-50c4-4095-adbf-b4e29f322d96",
      "properties": {},
      "x": 689,
      "y": 4870,
      "width": 270,
      "height": 166,
      "collapsed": false,
      "inherited": false,
      "registry": "agents/visual/generateImageEdit",
      "base_type": "core/Graph"
    },
    "05b86984-457b-4da7-ac59-15bde5e9b5e9": {
      "title": "GET obj.id",
      "id": "05b86984-457b-4da7-ac59-15bde5e9b5e9",
      "properties": {
        "attribute": "id"
      },
      "x": 549,
      "y": 4940,
      "width": 210,
      "height": 98,
      "collapsed": true,
      "inherited": false,
      "registry": "data/Get",
      "base_type": "core/Node"
    },
    "a1ed9e4a-1157-47f0-bb2a-f9982f9dd835": {
      "title": "Select Assets - Any Portrait",
      "id": "a1ed9e4a-1157-47f0-bb2a-f9982f9dd835",
      "properties": {
        "mode": "prioritize",
        "vis_types": [
          "CHARACTER_PORTRAIT"
        ],
        "reference_vis_types": []
      },
      "x": 1334,
      "y": 2357,
      "width": 312,
      "height": 166,
      "collapsed": false,
      "inherited": false,
      "registry": "assets/SelectAssets",
      "base_type": "core/Node"
    },
    "ee1a354e-61c0-4c9e-9c84-753043434b18": {
      "title": "Select Assets - Reference Card",
      "id": "ee1a354e-61c0-4c9e-9c84-753043434b18",
      "properties": {
        "mode": "prioritize",
        "vis_types": [
          "CHARACTER_CARD"
        ],
        "reference_vis_types": [
          "CHARACTER_PORTRAIT"
        ]
      },
      "x": 1694,
      "y": 2357,
      "width": 312,
      "height": 166,
      "collapsed": false,
      "inherited": false,
      "registry": "assets/SelectAssets",
      "base_type": "core/Node"
    },
    "e05b4c07-e7d0-4a03-9660-2d131f7643f3": {
      "title": "Stage 1",
      "id": "e05b4c07-e7d0-4a03-9660-2d131f7643f3",
      "properties": {
        "stage": 1
      },
      "x": 2720,
      "y": 2350,
      "width": 210,
      "height": 118,
      "collapsed": false,
      "inherited": false,
      "registry": "core/Stage",
      "base_type": "core/Node"
    },
    "93472463-8240-4b53-92c8-8d435e39ab6c": {
      "title": "Make Asset Meta",
      "id": "93472463-8240-4b53-92c8-8d435e39ab6c",
      "properties": {
        "name": "",
        "vis_type": "CHARACTER_PORTRAIT",
        "gen_type": "TEXT_TO_IMAGE",
        "character_name": "",
        "prompt": "",
        "negative_prompt": "",
        "reference_assets": [],
        "tags": [],
        "analysis": "",
        "reference": []
      },
      "x": 480,
      "y": 5010,
      "width": 279,
      "height": 514,
      "collapsed": true,
      "inherited": false,
      "registry": "assets/MakeAssetMeta",
      "base_type": "core/Node"
    }
  },
  "edges": {
    "bec1942f-73ed-4e79-b81d-a642acd5ef3d.value": [
      "70eee13c-fd74-48ad-b271-ed52d1ee3d08.value"
    ],
    "6180b4f6-b427-46c5-aff0-b3c9bc9456cd.value": [
      "364b7d86-9c20-4be2-b13c-98241d1d56ae.state"
    ],
    "919f53fb-15df-4d24-9448-a35d7e97d95e.value": [
      "25f779e2-a2de-4679-ad02-68bc0abfc97f.vis_type"
    ],
    "532da8c8-c513-4fe7-b409-db11dac3e14c.value": [
      "582f31dd-5e5e-4e0a-8e13-c69bd53bf1c5.value"
    ],
    "582f31dd-5e5e-4e0a-8e13-c69bd53bf1c5.no": [
      "25f779e2-a2de-4679-ad02-68bc0abfc97f.state"
    ],
    "e1050ab0-0e71-437e-a9ff-5e363dc93134.value": [
      "25f779e2-a2de-4679-ad02-68bc0abfc97f.character"
    ],
    "77b5b1ec-092c-47c8-afe0-495e9be9c306.value": [
      "364b7d86-9c20-4be2-b13c-98241d1d56ae.state_b"
    ],
    "9e71248d-dae3-40f7-9877-051247b38438.value": [
      "25f779e2-a2de-4679-ad02-68bc0abfc97f.instructions"
    ],
    "50a3576d-17da-4898-b80d-322b89fa4b99.value": [
      "c32025d8-50c4-4095-adbf-b4e29f322d96.instructions"
    ],
    "2e18f4ff-589d-4acd-b2d9-319e7aa6f787.value": [
      "9f3e368c-51fc-43ca-8232-3d19f192cb4b.value"
    ],
    "9f3e368c-51fc-43ca-8232-3d19f192cb4b.value": [
      "364b7d86-9c20-4be2-b13c-98241d1d56ae.state_c"
    ],
    "69fee541-2657-4d83-9e76-797414ea9216.value": [
      "d74a28ad-9466-4308-bf5d-db140ec603be.value"
    ],
    "d74a28ad-9466-4308-bf5d-db140ec603be.value": [
      "364b7d86-9c20-4be2-b13c-98241d1d56ae.state_d"
    ],
    "364b7d86-9c20-4be2-b13c-98241d1d56ae.state": [
      "9a364ad1-0277-41d4-ad3e-32fe25e2c8a3.value"
    ],
    "364b7d86-9c20-4be2-b13c-98241d1d56ae.state_b": [
      "520016cb-68f3-48fc-9140-fab4f543dc3e.value"
    ],
    "364b7d86-9c20-4be2-b13c-98241d1d56ae.state_c": [
      "5704877a-1515-4278-afc6-63407582bb2a.value"
    ],
    "364b7d86-9c20-4be2-b13c-98241d1d56ae.state_d": [
      "b3dfe45d-e034-4c0c-acb3-5fd1ab9f1ab5.value"
    ],
    "25f779e2-a2de-4679-ad02-68bc0abfc97f.generation_request": [
      "98a6bb29-821e-4ac2-8794-929d9a7e5e15.generation_request"
    ],
    "b7b66f17-9e3a-4130-a820-4694bb7954a8.object": [
      "5e189b32-7b1b-4347-8d57-22bd14da327e.generation_request"
    ],
    "6f376e1c-4f0a-49e3-ba5b-6bfbc5d4c379.value": [
      "34e22444-be73-401f-9a1c-99355d92f0aa.state_b"
    ],
    "fada2d18-c2ea-4445-834f-ffe2a0cc5c45.value": [
      "6f376e1c-4f0a-49e3-ba5b-6bfbc5d4c379.value"
    ],
    "f689149e-3f57-496a-97c9-bbfda3c0b52a.value": [
      "6981bc93-69f6-4ecd-917b-16c3dc529a3e.value"
    ],
    "8a20cc8d-965d-4cb8-93bf-0c0dc3fd0868.value": [
      "69fee541-2657-4d83-9e76-797414ea9216.value"
    ],
    "e061f98e-5fab-40a6-92c5-ed1ef73e70f8.value": [
      "2e18f4ff-589d-4acd-b2d9-319e7aa6f787.value"
    ],
    "2da731c0-aed3-4dbc-a523-a43c1e19b473.value": [
      "77b5b1ec-092c-47c8-afe0-495e9be9c306.value"
    ],
    "4bf4cc2c-fda6-4f3f-9e1e-5f1e3b3471d7.value": [
      "6180b4f6-b427-46c5-aff0-b3c9bc9456cd.value"
    ],
    "5e189b32-7b1b-4347-8d57-22bd14da327e.generation_request": [
      "92826cbe-afca-4cf3-b6ae-0fbf4bee833f.value"
    ],
    "9c0013ee-1340-4fd5-8e1c-dbbb2aadb16f.value": [
      "a71727c9-a167-40b9-a345-7f9c32f0211a.value"
    ],
    "6981bc93-69f6-4ecd-917b-16c3dc529a3e.value": [
      "34e22444-be73-401f-9a1c-99355d92f0aa.state"
    ],
    "98a6bb29-821e-4ac2-8794-929d9a7e5e15.generation_request": [
      "301cb0ff-7473-4550-bd96-81352c88e24d.value"
    ],
    "9916a889-2d11-424d-adea-519bfaca64c4.value": [
      "b362f642-5eb1-4d7f-abd4-1fddd5b9934d.value"
    ],
    "b362f642-5eb1-4d7f-abd4-1fddd5b9934d.value": [
      "34e22444-be73-401f-9a1c-99355d92f0aa.state_c"
    ],
    "34e22444-be73-401f-9a1c-99355d92f0aa.state": [
      "624767be-6e9d-4bbf-8def-1336b192b351.value"
    ],
    "34e22444-be73-401f-9a1c-99355d92f0aa.state_b": [
      "3cd66f03-788f-4f72-a576-90a6e5d29163.value"
    ],
    "34e22444-be73-401f-9a1c-99355d92f0aa.state_c": [
      "23fce388-6b3f-4bed-85d2-306fc0506c57.value"
    ],
    "7b07b286-d514-416b-b7dd-94a5c5754327.value": [
      "c32025d8-50c4-4095-adbf-b4e29f322d96.asset_ctx"
    ],
    "587a9224-a392-4f10-be85-d03bff530d4f.value": [
      "52fff89e-722a-49f7-89b0-ef3b4ec81e19.character"
    ],
    "9c215402-bbdb-4a65-a678-d4915ba815ca.value": [
      "442960c8-35c9-4097-9c93-5091d6cb9e28.current_avatar"
    ],
    "fd1e9c38-9178-46b5-840f-cefec6063d46.value": [
      "442960c8-35c9-4097-9c93-5091d6cb9e28.default_avatar"
    ],
    "1905ae2d-a859-47ac-94d8-71b31161534f.value": [
      "442960c8-35c9-4097-9c93-5091d6cb9e28.asset_name"
    ],
    "3d604b3c-5d13-4fa3-beac-3c0ba5d23771.value": [
      "442960c8-35c9-4097-9c93-5091d6cb9e28.tags"
    ],
    "442960c8-35c9-4097-9c93-5091d6cb9e28.asset_name": [
      "63b3fdcc-f74e-4e87-9528-48bb5afada96.item0"
    ],
    "442960c8-35c9-4097-9c93-5091d6cb9e28.tags": [
      "63b3fdcc-f74e-4e87-9528-48bb5afada96.item1"
    ],
    "442960c8-35c9-4097-9c93-5091d6cb9e28.default_avatar": [
      "63b3fdcc-f74e-4e87-9528-48bb5afada96.item2"
    ],
    "442960c8-35c9-4097-9c93-5091d6cb9e28.current_avatar": [
      "63b3fdcc-f74e-4e87-9528-48bb5afada96.item3"
    ],
    "442960c8-35c9-4097-9c93-5091d6cb9e28.override_default_avatar": [
      "63b3fdcc-f74e-4e87-9528-48bb5afada96.item4"
    ],
    "442960c8-35c9-4097-9c93-5091d6cb9e28.override_current_avatar": [
      "63b3fdcc-f74e-4e87-9528-48bb5afada96.item5"
    ],
    "dcda417b-ae12-4e10-a5fe-9e0d83c393bd.value": [
      "63b3fdcc-f74e-4e87-9528-48bb5afada96.state",
      "63b3fdcc-f74e-4e87-9528-48bb5afada96.object"
    ],
    "301cb0ff-7473-4550-bd96-81352c88e24d.value": [
      "8867ae83-17ea-4b7c-a126-30ca3d2c3aeb.state_b"
    ],
    "92826cbe-afca-4cf3-b6ae-0fbf4bee833f.value": [
      "65907aba-8fd7-4823-983c-21ba30f71609.state"
    ],
    "63b3fdcc-f74e-4e87-9528-48bb5afada96.state": [
      "240602dd-6a58-4a0d-a203-a17fdf01af84.state"
    ],
    "3ea7321d-3057-4c23-847b-64cb1d55e557.value": [
      "faf12e0a-6173-4532-b75e-9a203aa12728.character"
    ],
    "42e81dce-0ae6-46c2-a7dd-cbc2cedbf6d4.list": [
      "77953c4e-d035-4989-a97e-3e14a0704a85.vis_type"
    ],
    "faf12e0a-6173-4532-b75e-9a203aa12728.name": [
      "77953c4e-d035-4989-a97e-3e14a0704a85.character_name"
    ],
    "77953c4e-d035-4989-a97e-3e14a0704a85.asset_ids": [
      "99848a70-96a0-4a21-8386-ee6d8835e416.asset_ids"
    ],
    "99848a70-96a0-4a21-8386-ee6d8835e416.selection_context": [
      "a1ed9e4a-1157-47f0-bb2a-f9982f9dd835.selection_context"
    ],
    "42a99e33-536d-4c48-8474-e043a6f1c0b3.first": [
      "981fd216-08d1-49f0-91e8-2f66c735d1e7.value"
    ],
    "981fd216-08d1-49f0-91e8-2f66c735d1e7.value": [
      "e05b4c07-e7d0-4a03-9660-2d131f7643f3.state"
    ],
    "28ac3de8-6536-40d7-97ca-4a6d6f9cf16b.value": [
      "25f779e2-a2de-4679-ad02-68bc0abfc97f.asset_ctx"
    ],
    "52fff89e-722a-49f7-89b0-ef3b4ec81e19.name": [
      "b7b66f17-9e3a-4130-a820-4694bb7954a8.value"
    ],
    "02f5acc9-accd-42b6-981d-1eefe720ec1d.value": [
      "c3bea3c5-7f66-4209-8b15-2747db733324.value"
    ],
    "c3bea3c5-7f66-4209-8b15-2747db733324.yes": [
      "c32025d8-50c4-4095-adbf-b4e29f322d96.state",
      "05b86984-457b-4da7-ac59-15bde5e9b5e9.object"
    ],
    "c32025d8-50c4-4095-adbf-b4e29f322d96.generation_request": [
      "b7b66f17-9e3a-4130-a820-4694bb7954a8.object"
    ],
    "05b86984-457b-4da7-ac59-15bde5e9b5e9.value": [
      "c32025d8-50c4-4095-adbf-b4e29f322d96.asset_id"
    ],
    "a1ed9e4a-1157-47f0-bb2a-f9982f9dd835.selection_context": [
      "ee1a354e-61c0-4c9e-9c84-753043434b18.selection_context"
    ],
    "ee1a354e-61c0-4c9e-9c84-753043434b18.selection_context": [
      "42a99e33-536d-4c48-8474-e043a6f1c0b3.selection_context"
    ],
    "93472463-8240-4b53-92c8-8d435e39ab6c.vis_type": [
      "c32025d8-50c4-4095-adbf-b4e29f322d96.vis_type"
    ],
    "93472463-8240-4b53-92c8-8d435e39ab6c.format": [
      "c32025d8-50c4-4095-adbf-b4e29f322d96.format"
    ]
  },
  "groups": [
    {
      "title": "Input",
      "x": 2,
      "y": -13,
      "width": 1571,
      "height": 2220,
      "color": "#88A",
      "font_size": 24,
      "inherited": false
    },
    {
      "title": "Prepare",
      "x": -1,
      "y": 2207,
      "width": 2971,
      "height": 511,
      "color": "#8AA",
      "font_size": 24,
      "inherited": false
    },
    {
      "title": "Process - Create Image Without References",
      "x": 1,
      "y": 3672,
      "width": 2195,
      "height": 1015,
      "color": "#3f789e",
      "font_size": 24,
      "inherited": false
    },
    {
      "title": "Process - Generate Image With References",
      "x": 0,
      "y": 4690,
      "width": 2491,
      "height": 853,
      "color": "#3f789e",
      "font_size": 24,
      "inherited": false
    },
    {
      "title": "Output",
      "x": 1582,
      "y": -15,
      "width": 688,
      "height": 226,
      "color": "#8A8",
      "font_size": 24,
      "inherited": false
    },
    {
      "title": "Prepare - Update Asset Attachment Context",
      "x": 1,
      "y": 2724,
      "width": 1796,
      "height": 945,
      "color": "#8AA",
      "font_size": 24,
      "inherited": false
    }
  ],
  "comments": [
    {
      "text": "We update the activer asset attachment context to control which avatar states we update for the character (current and/or default), plus we pass on the generated asset name and tags as well",
      "x": 20,
      "y": 2775,
      "width": 613,
      "inherited": false
    },
    {
      "text": "Priority 1 - Character portrait that is marked as a reference.",
      "x": 1036,
      "y": 2562,
      "width": 200,
      "inherited": false
    },
    {
      "text": "Priority 2 - ANY character portrait",
      "x": 1396,
      "y": 2562,
      "width": 200,
      "inherited": false
    },
    {
      "text": "Priority 3 - Character Card that is marked as a reference",
      "x": 1746,
      "y": 2562,
      "width": 200,
      "inherited": false
    }
  ],
  "extends": null,
  "base_type": "core/Graph",
  "inputs": [],
  "outputs": [],
  "module_properties": {},
  "style": {
    "title_color": "#2d5a55",
    "node_color": "#1e3a38",
    "icon": "F16A3",
    "auto_title": null,
    "counterpart": null
  }
}